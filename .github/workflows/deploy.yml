# .github/workflows/deploy.yml
name: Deploy OneNetwork CRM to cPanel

on:
  push:
    branches: [ main ]
  workflow_dispatch: # Allows manual trigger

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Deploy to cPanel server
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: ${{ secrets.CPANEL_HOST }}
        username: ${{ secrets.CPANEL_USERNAME }}
        key: ${{ secrets.CPANEL_SSH_KEY }}
        script: |
          echo "ğŸš€ Starting deployment for OneNetwork CRM..."
          echo "ğŸ  Server: nl1-sr1.supercp.com"
          echo "ğŸ‘¤ User: onenetwo"
          
          # Navigate to project directory
          cd /home/onenetwo/public_html/crm-system
          echo "ğŸ“ Current directory: $(pwd)"
          
          # Show current git status
          echo "ğŸ“‹ Current git status:"
          git status
          
          # Pull latest changes
          echo "ğŸ“¥ Pulling latest changes from GitHub..."
          git pull origin main
          
          # Show what changed
          echo "ğŸ“ Recent commits:"
          git log --oneline -3
          
          # Set proper file permissions
          echo "ğŸ”§ Setting file permissions..."
          find . -type d -exec chmod 755 {} \;
          find . -type f -exec chmod 644 {} \;
          
          # If you have specific writable directories, uncomment these:
          # chmod -R 775 storage/ 2>/dev/null || true
          # chmod -R 775 cache/ 2>/dev/null || true
          # chmod -R 775 uploads/ 2>/dev/null || true
          
          echo "âœ… Deployment completed successfully!"
          echo "ğŸŒ Your CRM system is live at: https://onenetwork.se/crm-system"
          echo "â° Deployed at: $(date)"